# Build folder

This folder contains built code used to setup the AP with `as.sh` and `as_ui.sh` stored in the `Src/`.

## `hostapd`

`hostapd` comes from the build process of the code from the official Ubuntu repository.
The following process has been used:

1. Download the code from the Ubuntu repository by doing

    ```bash
    apt source hostapd
    ```

2. Go to the `hostapd/` folder.

3. Create the `.config` file by means of the command

    ```bash
    cp defconf .config
    ```

4. Check if the `.config` file contains the two following strings:

    ```bash
    CONFIG_SAE=y
    CONFIG_SAE_PK=y
    ```

    If these are not preset, please add them.

5. Finally, execute

    ```bash
    make
    ```

> It has been noted that if the `hostapd` version is equal or greater than the 2.11,
> then the `.config` file should already contains the two strings to allow the use of SAE and SAE-PK
> (this is valid for the code that can be found at [http://w1.fi/hostap.git](http://w1.fi/hostap.git)
> and [https://github.com/vanhoefm/hostap-wpa3.git](https://github.com/vanhoefm/hostap-wpa3.git)).

It is important to highlight that in the `.config` build file there are a lot of other features that are not enabled by default (like OCV). If a new AP configuration doesn't work properly, please checkout if all the required `CONFIG` strings are enabled at build time.

## `sae_pk_gen`

`sae_pk_gen` comes from the building process of the code from the (unofficial) `hostapd-wpa3` repository,
owned by Mathy Vanhoef. Indeed, even though the code from the Ubuntu (version 2.10) and w1.fi repositories
both contain the file `sae_pk_gen.c`, the relative MakeFile contains errors. These have been overcome by
Vanhoef and Jouni Malinen and the fixes included in the `hostapd-wpa3` repository.

To compile the program, the process is similar to the one followed for `hostapd`:

1. Download the code from the Vanhoef's repository by doing

    ```bash
    git clone https://github.com/vanhoefm/hostap-wpa3.git
    ```

2. Go to the hostapd folder.
3. Create the `.config` file by means of the command

    ```bash
    cp defconf .config
    ```

4. Check if the `.config` file contains the two following strings:

    ```bash
    CONFIG_SAE=y
    CONFIG_SAE_PK=y
    ```

    If these are not preset, please add them (they should be already present).

5. Execute

    ```bash
    make
    ```

6. Finally, execute

    ```bash
    make sae_pk_gen.c
    ```

### Generate a SAE-PK key

To generate the SAE-PK key, there are two possibilities:

- use `sae_pk_gen` directly, following the process explained below.
- use `sae_pk_key_gen.sh`, that automate the entire process. This can be found in the `Src/` directory.

#### Manually generate the SAE-PK key

These instructions are available at [https://github.com/vanhoefm/hostap-wpa3](https://github.com/vanhoefm/hostap-wpa3).

1. First generate a private key:

    ```bash
    openssl ecparam -name prime256v1 -genkey -noout -out key_file.der -outform der
    ```

2. Now derive the password from it:

    ```bash
    ./sae_pk_gen key_file.der sec ssid_name
    ```

3. The program will print a special string that starts like this:

    ```bash
    sae_password=abcd-defg-hijk|pk=...
    ```

    This string can be directly copied in the hostapd.conf file and will automatically enable WPA3 with SAE-PK.

Note that:

- `key_file.der` is the derived name of the `.der` file generated by openssl;
- `sec` can be 3 for weaker security, or 5 for stronger;
- `ssid_name` is specified without " ".
